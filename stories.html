<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <title>Hikoya Yozish</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>‚úçÔ∏è Hikoya Yozish</h1>

      <div id="form">
        <input type="text" id="storyTitle" placeholder="Hikoya nomi" />
        <textarea
          id="storyText"
          rows="6"
          placeholder="Hikoya matnini yozing..."
        ></textarea>
        <button style="cursor: pointer" id="saveBtn" onclick="saveStory()">
          üì• Saqlash
        </button>
      </div>

      <div id="storyList">
        <h3>üìö Hikoyalar ro'yxati:</h3>
        <div id="stories"></div>
      </div>

      <div id="storyView" style="display: none">
        <h3 id="viewTitle"></h3>
        <div id="storyDisplay"></div>
        <button
          style="
            text-decoration: none;
            font-size: 25px;
            padding-top: 200px;
            display: flex;
          "
          class="back-button"
          onclick="goBack()"
        >
          ‚¨ÖÔ∏è Ortga
        </button>
      </div>

      <p>
        <a
          style="
            text-decoration: none;
            font-size: 25px;
            padding-top: 200px;
            display: flex;
          "
          href="index.html"
          >‚¨ÖÔ∏è Asosiy sahifaga qaytish</a
        >
      </p>
    </div>

    <script>
      const titleInput = document.getElementById("storyTitle");
      const textInput = document.getElementById("storyText");
      const storiesDiv = document.getElementById("stories");
      const storyView = document.getElementById("storyView");
      const storyList = document.getElementById("storyList");
      const form = document.getElementById("form");
      const saveBtn = document.getElementById("saveBtn");

      let editIndex = null;

      function loadStories() {
        storiesDiv.innerHTML = "";
        let stories = JSON.parse(localStorage.getItem("hikoyalar") || "[]");
        stories.forEach((story, index) => {
          let div = document.createElement("div");
          div.className = "story-item";

          let title = document.createElement("h4");
          title.innerText = story.title;
          title.onclick = () => viewStory(index);
          div.appendChild(title);

          let actions = document.createElement("div");
          actions.className = "story-actions";

          let editBtn = document.createElement("button");
          editBtn.innerText = "‚úèÔ∏è Tahrirlash";
          editBtn.onclick = () => editStory(index);
          actions.appendChild(editBtn);

          let deleteBtn = document.createElement("button");
          deleteBtn.innerText = "üóëÔ∏è O‚Äòchirish";
          deleteBtn.onclick = () => deleteStory(index);
          actions.appendChild(deleteBtn);

          div.appendChild(actions);
          storiesDiv.appendChild(div);
        });
      }

      function saveStory() {
        let title = titleInput.value.trim();
        let text = textInput.value.trim();
        if (!title || !text) {
          alert("Iltimos, hikoya nomi va matnini to‚Äòldiring.");
          return;
        }
        let stories = JSON.parse(localStorage.getItem("hikoyalar") || "[]");

        if (editIndex !== null) {
          stories[editIndex] = { title, text };
          editIndex = null;
          saveBtn.innerText = "üì• Saqlash";
        } else {
          stories.push({ title, text });
        }

        localStorage.setItem("hikoyalar", JSON.stringify(stories));
        titleInput.value = "";
        textInput.value = "";
        loadStories();
      }

      function editStory(index) {
        let stories = JSON.parse(localStorage.getItem("hikoyalar") || "[]");
        titleInput.value = stories[index].title;
        textInput.value = stories[index].text;
        editIndex = index;
        saveBtn.innerText = "üíæ Yangilash";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function deleteStory(index) {
        if (confirm("Rostdan ham o‚Äòchirmoqchimisiz?")) {
          let stories = JSON.parse(localStorage.getItem("hikoyalar") || "[]");
          stories.splice(index, 1);
          localStorage.setItem("hikoyalar", JSON.stringify(stories));
          loadStories();
        }
      }

      function viewStory(index) {
        let stories = JSON.parse(localStorage.getItem("hikoyalar") || "[]");
        document.getElementById("viewTitle").innerText = stories[index].title;
        document.getElementById("storyDisplay").innerText = stories[index].text;
        form.style.display = "none";
        storyList.style.display = "none";
        storyView.style.display = "block";
      }

      function goBack() {
        storyView.style.display = "none";
        form.style.display = "block";
        storyList.style.display = "block";
      }

      loadStories();
    </script>
  </body>
</html>
